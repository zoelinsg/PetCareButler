{% extends "base.html" %}

{% block title %}{% if mode == "update" %}編輯事件{% else %}新增事件{% endif %}{% endblock %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-12">

      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-end gap-2 mb-3">
        <div>
          <h1 class="h4 fw-semibold mb-1">{% if mode == "update" %}編輯事件{% else %}新增事件{% endif %}</h1>
          <div class="text-muted small">用於醫療、疫苗與日常事務提醒</div>
        </div>
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'month' %}">回月曆</a>
      </div>

      <div class="card shadow-sm border-0">
        <div class="card-body p-4">

          {% if form %}
            <form method="post" novalidate>
              {% csrf_token %}

              {% if form.non_field_errors %}
                <div class="alert alert-danger">{{ form.non_field_errors }}</div>
              {% endif %}

              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label fw-semibold" for="{{ form.pet.id_for_label }}">{{ form.pet.label }}</label>
                  {{ form.pet }}
                  {% if form.pet.help_text %}<div class="form-text">{{ form.pet.help_text }}</div>{% endif %}
                  {% for error in form.pet.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold" for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
                  {{ form.title }}
                  {% if form.title.help_text %}<div class="form-text">{{ form.title.help_text }}</div>{% endif %}
                  {% for error in form.title.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="{{ form.type.id_for_label }}">{{ form.type.label }}</label>
                  {{ form.type }}
                  {% if form.type.help_text %}<div class="form-text">{{ form.type.help_text }}</div>{% endif %}
                  {% for error in form.type.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12 col-md-6 d-flex align-items-end">
                  <div class="form-check mb-2">
                    {{ form.all_day }}
                    <label class="form-check-label" for="{{ form.all_day.id_for_label }}">{{ form.all_day.label }}</label>
                    {% if form.all_day.help_text %}<div class="form-text">{{ form.all_day.help_text }}</div>{% endif %}
                    {% for error in form.all_day.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="{{ form.start_at.id_for_label }}">{{ form.start_at.label }}</label>
                  {{ form.start_at }}
                  {% if form.start_at.help_text %}<div class="form-text">{{ form.start_at.help_text }}</div>{% endif %}
                  {% for error in form.start_at.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="{{ form.end_at.id_for_label }}">{{ form.end_at.label }}</label>
                  {{ form.end_at }}
                  {% if form.end_at.help_text %}<div class="form-text">{{ form.end_at.help_text }}</div>{% endif %}
                  {% for error in form.end_at.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="{{ form.status.id_for_label }}">{{ form.status.label }}</label>
                  {{ form.status }}
                  {% if form.status.help_text %}<div class="form-text">{{ form.status.help_text }}</div>{% endif %}
                  {% for error in form.status.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="{{ form.remind_at.id_for_label }}">{{ form.remind_at.label }}</label>
                  {{ form.remind_at }}
                  {% if form.remind_at.help_text %}<div class="form-text">{{ form.remind_at.help_text }}</div>{% endif %}
                  {% for error in form.remind_at.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold" for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
                  {{ form.description }}
                  {% if form.description.help_text %}<div class="form-text">{{ form.description.help_text }}</div>{% endif %}
                  {% for error in form.description.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold" for="{{ form.note.id_for_label }}">{{ form.note.label }}</label>
                  {{ form.note }}
                  {% if form.note.help_text %}<div class="form-text">{{ form.note.help_text }}</div>{% endif %}
                  {% for error in form.note.errors %}<div class="text-danger small mt-1">{{ error }}</div>{% endfor %}
                </div>
              </div>

              <div class="d-flex gap-2 mt-4">
                <button type="submit" class="btn btn-primary">
                  {% if mode == "update" %}更新{% else %}儲存{% endif %}
                </button>
                <a class="btn btn-outline-secondary" href="{% url 'month' %}">取消</a>
              </div>
            </form>

            <script>
              (function () {
                const form = document.querySelector("form");
                if (!form) return;

                form.querySelectorAll("input, select, textarea").forEach((el) => {
                  const type = (el.getAttribute("type") || "").toLowerCase();
                  if (type === "checkbox" || type === "radio") {
                    el.classList.add("form-check-input");
                    return;
                  }
                  if (el.tagName.toLowerCase() === "select") {
                    el.classList.add("form-select");
                  } else if (el.tagName.toLowerCase() === "textarea") {
                    el.classList.add("form-control");
                  } else {
                    el.classList.add("form-control");
                  }
                });
              })();
            </script>

          {% else %}
            <div class="alert alert-warning mb-0">
              目前這頁沒有傳入 form（ModelForm）。建議使用 EventForm 渲染，以便套用一致的版面與驗證。
            </div>
          {% endif %}

        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}
